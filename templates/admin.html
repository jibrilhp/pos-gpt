<!DOCTYPE html>
<html>

<head>
  <title>Admin Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    .search-box {
      margin-bottom: 1rem;
    }

    .table-responsive {
      max-height: 75vh;
      overflow-y: auto;
    }

    th,
    td {
      white-space: nowrap;
    }

    .order-details {
      display: none;
    }

    .expand-btn {
      cursor: pointer;
    }
  </style>
</head>

<body class="p-3">
  <h3 class="mb-4 text-center">üìã Admin Dashboard</h3>

  <!-- Search -->
  <input id="searchInput" class="form-control search-box" type="text" placeholder="Cari nama / HP / catatan..."
    onkeyup="filterTable()">

  <!-- Table -->
  <div class="table-responsive">
    <table class="table table-bordered table-striped table-hover align-middle text-sm" id="orderTable">
      <thead class="table-dark">
        <tr>
          <th>Order ID</th>
          <th>Nama</th>
          <th>No. HP</th>
          <th>Catatan</th>
          <th>Status</th>
          <th>Created At</th>
          <th>Update Pembayaran</th>
          <th>Update Status</th>
          <th>Cetak</th>
        </tr>
      </thead>
      <tbody>
        {% for order in orders|sort(attribute='created_at', reverse=False) %}
        <tr>
          <td>{{ order.id }}</td>
          <td>{{ order.customer }}</td>
          <td>{{ order.phone }}</td>
          <td>{{ order.note }}</td>
          <td><span class="badge bg-secondary">{{ order.status }}</span></td>
          <td>{{ order.created_at }}</td>
          <td>
            <form method="post" action="/mark-paid/{{ order.id }}" class="d-inline">
              {% if not order.is_paid %}
              <button class="btn btn-sm btn-success">Tandai Sudah Dibayar</button>
              {% else %}
              <span class="badge bg-success">Sudah Dibayar</span>
              {% endif %}
            </form>
          </td>
          <td>
            <form method="post" action="/update-status/{{ order.id }}">
              <div class="input-group input-group-sm">
                <select name="status" class="form-select">
                  <option {% if order.status=="Menunggu Konfirmasi" %}selected{% endif %}>Menunggu Konfirmasi</option>
                  <option {% if order.status=="Diproses" %}selected{% endif %}>Diproses</option>
                  <option {% if order.status=="Sudah Siap" %}selected{% endif %}>Sudah Siap</option>
                  <option {% if order.status=="Selesai" %}selected{% endif %}>Selesai</option>
                </select>
                <button class="btn btn-primary" type="submit">OK</button>
              </div>
            </form>
          </td>
          <td>
            <a href="/receipt/{{ order.id }}" target="_blank" class="btn btn-sm btn-secondary">
              üñ®Ô∏è Cetak Struk
            </a>
          </td>
        </tr>

        <!-- Expandable Details Row -->
        <tr class="order-details" id="details-{{ order.id }}">
          <td colspan="8">
            <table class="table table-sm table-bordered">
              <thead class="table-dark">
                <tr>
                  <th>Menu</th>
                  <th>Qty</th>
                  <th>Catatan Menu</th>
                </tr>
              </thead>
              <tbody>
                {% for item in order.items %}
                <tr>
                  <td>{{ item.menu.name }}</td>
                  <td>{{ item.qty }}</td>
                  <td>{{ item.note }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </td>
        </tr>
        {% endfor %}

      </tbody>
    </table>
  </div>

  <script>
    function filterTable() {
      const input = document.getElementById("searchInput").value.toLowerCase();
      const rows = document.querySelectorAll("#orderTable tbody tr");
      rows.forEach(row => {
        const text = row.innerText.toLowerCase();
        row.style.display = text.includes(input) ? "" : "none";
      });
    }

    // Function to toggle order details visibility
    function toggleDetails(orderId) {
      const detailsRow = document.getElementById('details-' + orderId);
      if (detailsRow.style.display === "none" || detailsRow.style.display === "") {
        detailsRow.style.display = "table-row";
      } else {
        detailsRow.style.display = "none";
      }
    }
  </script>
</body>

</html>